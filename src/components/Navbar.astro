---
import Icon from "./Icon.astro";
import { type Link } from "../types/link";

interface Props {
  links: Link[];
}

const { links } = Astro.props;
const currentPath = Astro.url.pathname;
---

<nav
  aria-label="Main navigation"
  class="flex min-h-[120px] w-full flex-row items-start justify-center gap-16"
>
  {
    links.map((link) => {
      const isActive =
        currentPath === link.link ||
        (currentPath === "/" && link.link === "/#projects");
      return (
        <a
          id={`${link.id}_nav`}
          aria-label={link.alt}
          aria-current={isActive ? "page" : undefined}
          class="lg:opacity-85 dark:lg:opacity-85 flex flex-col items-center justify-center gap-0 rounded-xl text-xl text-black transition-all duration-200 hover:fancy hover:text-black active:text-black dark:text-white dark:hover:text-white dark:active:text-white hover:md:pb-4 hover:md:pt-8"
          href={link.link}
        >
          <span class="sr-only lg:not-sr-only">{link.title}</span>
          <Icon
            class="h-10 w-10 text-black dark:text-white"
            name={link.icon}
            decorative={true}
          />
        </a>
      );
    })
  }
</nav>

<script define:vars={{ links }} is:inline>
  const hoverStyle = [
    "lg:px-8",
    "lg:pb-4",
    "lg:pt-8",
    "lg:indent-0",
    "lg:opacity-100",
  ];

  const transparentStyle = ["lg:opacity-85", "dark:lg:opacity-85"];

  const handleUpdatingActiveNavItems = (elements) => {
    elements.forEach((element) => {
      const middle = window.innerHeight / 2 + window.scrollY;
      const scrolledToElement = document.getElementById(`${element.id}_nav`);

      if (
        middle > element.offsetTop &&
        middle < element.offsetTop + element.offsetHeight
      ) {
        scrolledToElement?.classList.remove(...transparentStyle);
        scrolledToElement?.classList.add(...hoverStyle);
      } else {
        scrolledToElement?.classList.add(...transparentStyle);
        scrolledToElement?.classList.remove(...hoverStyle);
      }
    });
  };

  let scrollHandler;

  document.addEventListener("astro:before-swap", () => {
    if (scrollHandler) {
      window.removeEventListener("scroll", scrollHandler);
    }
  });

  document.addEventListener(
    "astro:page-load",
    () => {
      const elements = links.map((link) => document.getElementById(link.id));
      scrollHandler = () => handleUpdatingActiveNavItems(elements);
      window.addEventListener("scroll", scrollHandler);
      handleUpdatingActiveNavItems(elements);
    },
    { once: true },
  );
</script>
